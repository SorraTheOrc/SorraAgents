# Minimal Containerfile for Distrobox development containers.
# Tooling (Python, Node.js, wl, git, gh, opencode) comes from the host via
# two mechanisms:
#   1. Home directory mount — Distrobox mounts ~ automatically, providing
#      binaries in ~/.local/bin, ~/.cargo/bin, ~/.npm-global/bin, etc.
#   2. Host filesystem at /run/host — Distrobox mounts the host root here.
#      System binaries (git, ssh, etc.) live at /run/host/usr/bin and must
#      be added to PATH after Distrobox init completes. This is done by the
#      start-work setup script (NOT here in the image) because adding
#      /run/host paths to PATH at image build time causes Distrobox's own
#      init to pick up host binaries linked against host-only shared
#      libraries, which crash inside the container.
#
# Build:
#   podman build -t ampa-dev:latest ampa/
#
# Verify:
#   podman build -t ampa-dev:latest ampa/ && podman images | grep ampa-dev

FROM debian:stable-slim

ENV DEBIAN_FRONTEND=noninteractive

# Install only the packages Distrobox needs to function correctly inside the
# container plus basic utilities for shell sessions.  Distrobox injects its
# own init system and expects coreutils, bash, and a few networking/system
# tools to be available.
#
# Developer toolchain (Python, Node.js, wl, git, gh) is NOT installed here;
# it comes from the host via the home directory mount and /run/host paths
# (added to PATH by the start-work setup script after Distrobox init).
RUN apt-get update \
 && apt-get install -y --no-install-recommends \
    bash \
    bc \
    bzip2 \
    ca-certificates \
    curl \
    diffutils \
    findutils \
    gnupg2 \
    less \
    lsof \
    ncurses-base \
    passwd \
    pinentry-curses \
    procps \
    sudo \
    unzip \
    wget \
    xz-utils \
    zip \
 && rm -rf /var/lib/apt/lists/*

# Working directory where the project will be cloned inside the container.
WORKDIR /workdir

# Default to an interactive shell. Distrobox will typically enter the container
# with the user's UID and provide an interactive session; keep this image simple.
CMD ["/bin/bash"]
