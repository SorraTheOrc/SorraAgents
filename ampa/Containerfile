# Minimal Containerfile for Distrobox development containers.
# Tooling (Python, Node.js, wl, git, gh, opencode) comes from the host via
# two mechanisms:
#   1. Home directory mount — Distrobox mounts ~ automatically, providing
#      binaries in ~/.local/bin, ~/.cargo/bin, ~/.npm-global/bin, etc.
#   2. Host filesystem at /run/host — Distrobox mounts the host root here.
#      System binaries (git, ssh, etc.) live at /run/host/usr/bin and must
#      be on PATH explicitly (Distrobox does not add them automatically).
#
# Build:
#   podman build -t ampa-dev:latest ampa/
#
# Verify:
#   podman build -t ampa-dev:latest ampa/ && podman images | grep ampa-dev

FROM debian:stable-slim

ENV DEBIAN_FRONTEND=noninteractive

# Install only the packages Distrobox needs to function correctly inside the
# container plus basic utilities for shell sessions.  Distrobox injects its
# own init system and expects coreutils, bash, and a few networking/system
# tools to be available.
#
# Developer toolchain (Python, Node.js, wl, git, gh) is NOT installed here;
# it comes from the mounted home directory and /run/host paths.
RUN apt-get update \
 && apt-get install -y --no-install-recommends \
    bash \
    bc \
    bzip2 \
    ca-certificates \
    curl \
    diffutils \
    findutils \
    gnupg2 \
    less \
    lsof \
    ncurses-base \
    passwd \
    pinentry-curses \
    procps \
    sudo \
    unzip \
    wget \
    xz-utils \
    zip \
 && rm -rf /var/lib/apt/lists/*

# Expose host system binaries inside the container.  Distrobox mounts the
# host root at /run/host but does not add it to PATH automatically.
# These paths make host-installed tools (git, ssh, etc.) available without
# requiring distrobox-export or host-spawn wrappers.
ENV PATH="/run/host/usr/local/sbin:/run/host/usr/local/bin:/run/host/usr/sbin:/run/host/usr/bin:/run/host/sbin:/run/host/bin:${PATH}"

# Working directory where the project will be cloned inside the container.
WORKDIR /workdir

# Default to an interactive shell. Distrobox will typically enter the container
# with the user's UID and provide an interactive session; keep this image simple.
CMD ["/bin/bash"]
